<!DOCTYPE html>
<html lang="ru">
<head>
    {% include 'components/meta_tags.html' %}
    <meta name="description" content="–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}">
    <meta name="keywords" content="–ø—Ä–æ—Ñ–∏–ª—å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, {{ user.username }}">
    {% load static %}
    {% include 'components/linker.html' %}
</head>
<body>
    <script src="{% static 'js/second-loader.js' %}"></script>
    {% include 'components/loader.html' %}

    <div id="page-container" class="fade" style="display: none;">
        {% include 'header.html' %}

        <main class="profile-main">
        <div class="container profile-container">
            <div class="profile-header">
                <h1>{{ username }}</h1>
                <p>–í–∞—à –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
            </div>

            <div class="profile-section">
                <h3><i class="fas fa-gem"></i> –ê–∫—Ç–∏–≤–Ω—ã–π –ø–ª–∞–Ω</h3>
                <ul class="profile-list">
                    <li>
                        <span class="label">–¢–∞—Ä–∏—Ñ</span>
                        <span class="value plan-name">{{ subscription.plan_name }}</span>
                    </li>
                    <li>
                        <span class="label">–î–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –¥–æ</span>
                        <span class="value">{{ subscription.plan_end_date }}</span>
                    </li>
                </ul>
                {% if subscription.days_until_end is not none and subscription.days_until_end < 3 %}
                    <a class="button-medium button-accent section-action-button" href="{% url 'payment' %}"><div><p>–ü—Ä–æ–¥–ª–∏—Ç—å üíé</p></div></a>
                {% elif subscription_level < 2 or subscription_level == 99 %}
                    <a href="{% url 'payment' %}" class="button-medium button-accent section-action-button"><div><p>–ö—É–ø–∏—Ç—å –ü—Ä–µ–º–∏—É–º üíé</p></div></a>
                {% endif %}
            </div>

            <hr class="profile-divider">

            <div class="profile-section">
                <h3><i class="fas fa-user-cog"></i> –ê–∫–∫–∞—É–Ω—Ç</h3>
                <ul class="profile-list">
                    {% if email %}<li><span class="label">E-mail</span><span class="value">{{ user.email }}</span></li>{% endif %}
                    {% if phone != '–¢–µ–ª–µ—Ñ–æ–Ω: –ù–µ —É–∫–∞–∑–∞–Ω' %}<li><span class="label">–¢–µ–ª–µ—Ñ–æ–Ω</span><span class="value">{{ user.phone }}</span></li>{% endif %}
                </ul>
                <div class="account-actions">
                    {% if password != '' %}
                        <form method="post" action="{% url 'password_reset' %}">
                            {% csrf_token %}
                            <button type="submit" class="button-medium"><div><p>–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</p></div></button>
                        </form>
                    {% endif %}
                    <div class="button-medium button-red" id="logout-button"><div><p>–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</p></div></div>
                </div>
                 {% if user.is_superuser %}
                    <a class="button-medium admin-button" href="{% url 'db_viewer' %}"><div><p>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å üëë</p></div></a>
                {% endif %}
            </div>
            
            <hr class="profile-divider">

            <div class="profile-section">
                <h3><i class="fas fa-chart-pie"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <ul class="profile-list">
                    <li>
                        <span class="label">–°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤</span>
                        <span class="value">{{ statistics.total_tests }}</span>
                    </li>
                    <li>
                        <span class="label">–ü—Ä–æ–π–¥–µ–Ω–æ —É—á–µ–Ω–∏–∫–∞–º–∏</span>
                        <span class="value">{{ statistics.passed_tests }}</span>
                    </li>
                    <li>
                        <span class="label">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</span>
                        <span class="value">{{ statistics.best_result }}</span>
                    </li>
                </ul>
            </div>

            <hr class="profile-divider">

            <div class="profile-section">
                <h3><i class="fas fa-sliders-h"></i> –õ–∏–º–∏—Ç—ã –∏ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ</h3>
                <ul class="profile-list">
                    <li>
                        <span class="label">–î–æ—Å—Ç—É–ø–Ω–æ —Ç–µ—Å—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è</span>
                        <span class="value accent-color-text">{{ tokens.tests_remaining_count_limit }} / {{ tokens.tests_total_limit }}</span>
                    </li>
                    <li>
                        <span class="label">–¢–æ–∫–µ–Ω—ã –ò–ò (—Ç–µ—Å—Ç—ã)</span>
                        <span class="value">{{tokens.surveys}}</span>
                    </li>
                     <li>
                        <span class="label">–¢–æ–∫–µ–Ω—ã –ò–ò (—Ñ–∏–¥–±—ç–∫)</span>
                        <span class="value">{{tokens.feedback}}</span>
                    </li>
                </ul>
            </div>
        </div>
    </main>

    <div id="modal-exit" class="modal">
        <div class="modal-content">
            <h3>–í—ã —É–≤–µ—Ä–µ–Ω—ã?</h3>
            <p>–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</p>
            <div class="buttons-container">
                <button id="cancel-logout" class="">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirm-logout"  class="button-red">–í—ã–π—Ç–∏</button>
            </div>
        </div>
    </div>

    <script>
        function modalWindow(elementId) {
            document.getElementById('logout-button').addEventListener('click', function() {
                document.getElementById(elementId).style.display = 'flex';
            });
            
            document.getElementById('cancel-logout').addEventListener('click', function() {
                document.getElementById(elementId).style.display = 'none';
            });
            
            document.getElementById('confirm-logout').addEventListener('click', function() {
                window.location.href = "{% url 'logout' %}";
            });
        }

        modalWindow('modal-exit-menu');
        modalWindow('modal-exit');
    </script>

</body>
</html>
