<!DOCTYPE html>
<html lang="ru">
<head>
    {% include 'components/meta_tags.html' %}
    <meta name="description" content="Создайте персонализированные тесты за считанные минуты с помощью ИИ. Загружайте учебные материалы и получайте мгновенные квизы для эффективной подготовки к экзаменам.">
    <meta name="keywords" content="создание тестов, генерация тестов, тесты с ИИ, персонализированные квизы, подготовка к экзаменам, учебные материалы, онлайн тесты">
    <meta name="author" content="Летучка/Letychka by Kozak Developer">
    <meta property="og:title" content="Создание тестов с ИИ - Летучка">
    <meta property="og:description" content="Используйте ИИ для создания тестов на основе ваших учебных материалов. Быстро, удобно и эффективно!">
    <meta name="csrf-token" content="{{ csrf_token }}">
    {% load static %}
    <link rel="shortcut icon" href="{% static 'img/logo.png' %}" type="image/png">
    
    {% include 'components/linker.html' %}
    <link rel="stylesheet" href="{% static 'css/upload-styles.css' %}?v=1.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Yandex.Metrika counter -->
    <script type="text/javascript">
        (function(m,e,t,r,i,k,a){
            m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
            m[i].l=1*new Date();
            for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
            k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
        })(window, document,'script','https://mc.yandex.ru/metrika/tag.js', 'ym');
        ym(98829160, 'init', {webvisor:true, clickmap:true, accurateTrackBounce:true, trackLinks:true});
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/98829160" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
</head>

<style>
    footer {
        margin-top: 0;
    }
</style>

<body class="bg-create">
    <div id="toast" class="toast hidden">
        <span id="toast-message">Сообщение</span>
    </div>

    <script src="{% static 'js/second-loader.js' %}"></script>

    {% include 'components/loader.html' %}
    
    <div id="overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999;">
        <div class="loader-container" style="display: flex; justify-content: center; align-items: center; height: 100%;">
            <span class="loader"></span>
        </div>
    </div>
    
    <div id="page-container" class="fade" style="display: none;">
        {% include 'header.html' %}

        <div class="container glass-metrics-container">
            <div class="metrics-scroll-box">
                <div class="metric-ios active">
                    <span class="metric-title">Создано Вами</span>
                    <span class="metric-badge"><strong>{{ total_tests }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Успешно пройдено</span>
                    <span class="metric-badge"><strong>{{ passed_tests }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Создано пользователями сегодня</span>
                    <span class="metric-badge"><strong>{{ today_uploads }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Фидбэка от ИИ</span>
                    <span class="metric-badge"><strong>{{ feedback_count }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Всего вопросов создано</span>
                    <span class="metric-badge"><strong>{{ total_questions }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Вопросов в среднем</span>
                    <span class="metric-badge"><strong>{{ avg_questions }}</strong> на тест</span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Ответов за всё время</span>
                    <span class="metric-badge"><strong>{{ total_answers }}</strong> раз</span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Средне верно</span>
                    <span class="metric-badge"><strong>{{ avg_correct_answers|default:"–" }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Моделей опробовано</span>
                    <span class="metric-badge"><strong>{{ unique_models_count }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Тестов в этом месяце</span>
                    <span class="metric-badge"><strong>{{ tests_this_month }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Фидбэка от ИИ за неделю</span>
                    <span class="metric-badge"><strong>{{ feedback_last_week }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">ИИ оценивал</span>
                    <span class="metric-badge"><strong>{{ percent_with_feedback }}</strong></span>
                </div>
                <div class="metric-ios">
                    <span class="metric-title">Решённых тестов</span>
                    <span class="metric-badge"><strong>{{ tests_created_and_passed }}</strong></span>
                </div>
            </div>
        </div>

        <div class="container" id="file-preview-container" style="display: none;">
            <div id="attached-file-name">
                ✅ Прикреплен файл: <strong></strong>
            </div>
            <div class="file-preview">
                <div class="file-icon">
                    <img src="{% static 'img/icon-file3d.png' %}" alt="File Icon">
                </div>
                <div class="file-info">
                    <div class="file-name"><strong id="preview-file-name"></strong></div>
                    <div class="file-size"><strong id="preview-file-size"></strong></div>
                    <div class="button-medium" id="remove-file-button" style="display: none;" onclick="removeUploadedFile()">
                        <div>
                            <img src="{% static 'img/icon-delete.png' %}" alt="Удалить файл">
                            <p>Открепить</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if subscription_status != 'active' %}
            <div class="container notice-banner deactivated">
                <div class="icon-wrapper">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="text-wrapper">
                    <h3>Ваши Премиум-возможности отключены</h3>
                    <p>
                        Активируйте подписку, чтобы снова <strong>превращать Ваши учебные материалы и&nbsp;документы в&nbsp;тесты за&nbsp;считанные секунды</strong>, получать фидбэк от&nbsp;ИИ, а&nbsp;также работать без оглядки на&nbsp;лимиты.
                    </p>
                </div>
                <a class="button-medium button-accent" href="{% url 'payment' %}">
                    <div><i class="fas fa-rocket"></i> <p>Оформить Премиум</p></div>
                </a>
            </div>
        {% endif %}

        {% if subscription_level < 2 %}
            <div class="container locked-upload-integrated">
                <div class="icon-wrapper">
                    <i class="fas fa-gift text-6xl text-[var(--secondary-color)]"></i>
                </div>
                <div class="text-wrapper">
                    <h3>Осенний бонус – <span style="color: var(--secondary-color);">+15 дней в&nbsp;подарок!</span></h3>
                    <p>Получите <span style="color: var(--secondary-color);">на 50% больше времени</span> для&nbsp;творчества и&nbsp;отдыха с&nbsp;Летучкой</p><br>
                    <p>Только <span style="color: var(--secondary-color);">до конца сентября</span> мы&nbsp;превращаем каждый купленный месяц – в&nbsp;полтора. Освободите свои вечера от&nbsp;рутины — инвестируйте в&nbsp;себя.</p>
                </div>
                <a class="button-medium button-accent" href="{% url 'payment' %}">
                    <div><img src="{% static 'img/icon-diamond.png' %}" alt=""> <p>Воспользоваться</p></div>
                </a>
            </div>
        {% else %}

        {% endif %}

        <style>
            .features-container {
                margin-top: 20px;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Адаптивность */
                gap: 24px;
            }
            .feature-block {
                position: relative;
                overflow: hidden;
                background: rgba(93, 86, 110, 0.12);
                border-radius: 18px;
                padding: 24px;
                text-align: center;
                transition: all 0.25s ease;
                text-decoration: none; /* Для ссылок */
            }
            .feature-block:hover {
                transform: translateY(-4px);
                background: rgba(93, 86, 110, 0.2);
            }
            .feature-icon {
                width: 48px;
                height: 48px;
                margin: 0 auto 16px; /* Авто-отступ для центрирования */
            }
            .feature-block h3 {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 8px;
                color: #ffffff;
            }
            .feature-block p {
                font-size: 13px;
                color: #c0c0c0;
                line-height: 1.6;
                margin: 0;
            }

            /* СТИЛИ ДЛЯ ПРЕМИУМ-ЗАГЛУШЕК (ДЛЯ СТАРТОВЫХ) */
            .feature-badge {
                position: absolute;
                top: 12px;
                right: -40px;
                background-color: var(--color-accent-primary);
                color: white;
                padding: 4px 40px;
                font-size: 10px;
                font-weight: 700;
                text-transform: uppercase;
                transform: rotate(45deg);
                box-shadow: 0 0 10px rgba(0,0,0,0.5);
            }
            .feature-block.premium-feature {
                opacity: 0.7;
            }
            .feature-block.premium-feature:hover {
                opacity: 1;
            }

            .feature-block.quick-link h3 {
                color: var(--secondary-color);
            }
            .feature-block.quick-link .accent {
                color: var(--primary-color);
            }
        </style>

        <div class="container features-container">

        {% if subscription_level >= 2 %}
            <div class="feature-block quick-link">
                <img src="{% static 'img/icon-create.png' %}" alt="Генерация" class="feature-icon">
                <h3>Создать из файла</h3>
                <p>Загружайте файлы PDF/Word, из&nbsp;которых&nbsp;ИИ создаст тест за&nbsp;считанные секунды (скрепка рядом с&nbsp;полем ввода).</p>
            </div>
            <a href="{% url 'history' %}" class="feature-block quick-link">
                <img src="{% static 'img/icon-analytics.png' %}" alt="Анализ" class="feature-icon">
                <h3>Мои результаты</h3>
                <p>Проходите тесты и&nbsp;получайте персональный фидбэк от&nbsp;ИИ</p>
                <p class="accent">Нажмите, чтобы перейти</p>
            </a>
            <a href="{% url 'history' %}" class="feature-block quick-link">
                <img src="{% static 'img/icon-link.png' %}" alt="Поделиться" class="feature-icon">
                <h3>Делитесь</h3>
                <p>Делитесь своими тестами и&nbsp;просматривайте аналитику по&nbsp;прохождениям.</p>
                <p class="accent">Нажмите, чтобы выбрать тест и поделиться им</p>
            </a>
        {% else %}
            <div class="feature-block premium-feature">
                <div class="feature-badge">ПРЕМИУМ</div>
                <img src="{% static 'img/icon-create.png' %}" alt="Генерация" class="feature-icon">
                <h3>Контент → Тест</h3>
                <p class="accent">Загружайте файлы PDF/Word, из&nbsp;которых&nbsp;ИИ создаст тест за&nbsp;секунды.</p>
                <a href="/payment">Открыть возможности</a>
            </div>
            
            <div class="feature-block premium-feature">
                <div class="feature-badge">ПРЕМИУМ</div>
                <img src="{% static 'img/icon-analytics.png' %}" alt="Анализ" class="feature-icon">
                <h3>Умная аналитика</h3>
                <p class="accent">Получайте детальный разбор ошибок от ИИ.</p>
                <a href="/payment">Разблокировать фидбэк от ИИ</a>
            </div>
            
            <div class="feature-block">
                <img src="{% static 'img/icon-link.png' %}" alt="Поделиться" class="feature-icon">
                <h3>Быстрый обмен</h3>
                <p>Делитесь ссылкой на тест или скачивайте готовый к печати PDF.</p>
            </div>

        {% endif %}
    </div>
                
        <section class="container" id="recent-history-container">
            <h3><i class="fas fa-history"></i> Недавние тесты</h3>
            <div id="history-content">
                <!-- Сюда JavaScript вставит прелоадер, список тестов или сообщение о пустоте -->
            </div>
        </section>
        
        <div class="container" id="block-generate">
            <form id="text-form" method="post" onsubmit="event.preventDefault(); submitText();">
                {% csrf_token %}
                <div class="input-area">
                    <textarea id="user-text" rows="4" cols="60" placeholder="Введите здесь тему, содержание статьи или текст из методички..."></textarea>
                    
                    <div class="input-buttons-wrapper">
                        {% if subscription_level > 1 and subscription_level < 50 %}
                            <button type="button" class="attach-button" title="Прикрепить файл" onclick="document.getElementById('hidden-file-input').click();">
                                <i class="fas fa-paperclip"></i>
                            </button>
                        {% endif %}
                        <button type="button" class="send-button" title="Создать тест" onclick="submitText()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>

                <div class="controls-toolbar">
                    <div class="slider-container">
                        <p id="question-slider-text"><span id="slider-value">5</span> вопросов</p>
                        <input type="range" id="question-slider" class="custom-slider" min="1" max="15" value="5" style="display: none;">
                    </div>
                    <div id="char-count">0 / 32768</div>
                    
                </div>
                <div class="toolbar-actions">
                        <a class="button-medium" href="{% url 'history' %}" title="История генераций">
                            <div><i class="fas fa-history"></i><p>История</p></div>
                        </a>
                        <a class="button-medium" href="{% url 'payment' %}" title="Ваши лимиты">
                            <div><i class="fas fa-star"></i><p><span>{{ tests_today }}</span></p></div>
                        </a>
                    </div>
                
                {% if subscription_level > 1 and subscription_level < 50 %}
                    <input type="file" id="hidden-file-input" accept=".pdf, .doc, .docx, .txt" style="display: none;" onchange="handleFiles(this.files)">
                {% endif %}
            </form>
        </div>

        <script>
            document.querySelectorAll('.faq-question').forEach(item => {
                item.addEventListener('click', () => {
                    const answer = item.nextElementSibling;
            
                    if (answer.style.display === "block") {
                        answer.style.display = "none";
                    } else {
                        answer.style.display = "block";
                    }
                });
            });
        </script>
        
        {% include 'footer-s.html' %}
    </div>

    <script src="{% static 'js/main.js' %}?v=1.1"></script>
    <script src="{% static 'js/auto-scroll.js' %}"></script>

    <script>
    // Фикс для iOS - предотвращение масштабирования
    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('user-text');
        
        textarea.addEventListener('focus', function() {
            document.querySelector('meta[name="viewport"]').content = 
                'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
        });
        
        textarea.addEventListener('blur', function() {
            document.querySelector('meta[name="viewport"]').content = 
                'width=device-width, initial-scale=1.0';
        });
        
        textarea.addEventListener('input', function() {
            document.getElementById('char-count').textContent = 
                this.value.length + '/32768';
        });
        
        const slider = document.getElementById('question-slider');
        slider.addEventListener('input', function() {
            document.getElementById('question-count').textContent = 
                this.value + (this.value == 1 ? ' вопрос' : ' вопросов');
        });
    });
    </script>

    <script>
        let current = 0;
        const metrics = document.querySelectorAll('.metric-ios');

        function cycleMetrics() {
            metrics[current].classList.remove('active');
            current = (current + 1) % metrics.length;
            metrics[current].classList.add('active');
        }

        setInterval(cycleMetrics, 5000);
    </script>
</body>
</html>
